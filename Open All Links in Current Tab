// ==UserScript==
// @name         Force Open in Same Tab
// @namespace    http://tampermonkey.net/
// @version      1.0
// @match        *://*/*
// @grant        none
// ==/UserScript==

(function () {
    'use strict';

    // 1. 拦截 window.open
    const originalOpen = window.open;
    window.open = function (url) {
        if (url) {
            window.location.href = url;
        }
        return null;
    };

    // 2. 移除所有 target="_blank"
    function removeTargets() {
        document.querySelectorAll('a[target]').forEach(a => {
            a.removeAttribute('target');
        });
        document.querySelectorAll('base[target]').forEach(b => {
            b.removeAttribute('target');
        });
    }

    // 3. 监听动态 DOM
    new MutationObserver(removeTargets)
        .observe(document.documentElement, { childList: true, subtree: true });

    removeTargets();
})();
